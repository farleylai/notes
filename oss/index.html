<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>OSS | A Fuzzy Philosopher</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="OSS" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Farley’s personal website." />
<meta property="og:description" content="Farley’s personal website." />
<link rel="canonical" href="https://farley.metax.vision/oss/" />
<meta property="og:url" content="https://farley.metax.vision/oss/" />
<meta property="og:site_name" content="A Fuzzy Philosopher" />
<script type="application/ld+json">
{"url":"https://farley.metax.vision/oss/","@type":"WebPage","headline":"OSS","description":"Farley’s personal website.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://farley.metax.vision/feed.xml" title="A Fuzzy Philosopher" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />

<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">A Fuzzy Philosopher</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a><a class="page-link" href="/creative/">Creative</a><a class="page-link" href="/oss/">OSS</a><a class="page-link" href="/portfolio/">Portfolio</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/tags/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">OSS</h1>
  </header>

  <div class="post-content">
    <style type="text/css">
.image-left {
  display: block;
  margin-top: 5px;  
  margin-right: 15px;
  margin-bottom: 0px;
  float: left;
}
</style>

<p>In the past few years of working at NEC Labs, I have managed to release several OSS pacakges on GitHub for ease of the deployment of a retail video surveillance POC.
The design and organization follow the Dependency Inversion Principle (DIP) instead of direct dependencies on a particular deep learning framework such as <code class="language-plaintext highlighter-rouge">PyTorch</code>.
A target ML application is supposed to invoke the APIs provided by the packages.
While the best documentation is the code per se, several feature highlights are worth going through.
Hopefully, one may find them useful for production ML applications.</p>

<h2 id="ml"><a href="https://github.com/necla-ml/ML">ML</a></h2>

<p>So far, the only backend is <code class="language-plaintext highlighter-rouge">PyTorch</code> and <code class="language-plaintext highlighter-rouge">ML</code> essentially mimics the APIs.
Nonetheless, it is possible to replace with other alternatives such as <code class="language-plaintext highlighter-rouge">TensorFlow</code>.
This is in case that the lastest release of <code class="language-plaintext highlighter-rouge">PyTorch</code> comes with incompatibility or even bugs.
In that regard, it allows <code class="language-plaintext highlighter-rouge">ML</code> to quickly work around those potential issues before the official fix such taht the target ML application remains intact.</p>

<!-- Feature highlights:
- Flexible Configurations
- HDF5 Compression
- GPU Visibility
- Daemon Mode
- Distributed Training and Execution
- TensorRT Deployment
- Checkpoints from AWS/S3 and Google Drive -->

<h3 id="flexible-configurations">Flexible Configurations</h3>

<p>The configuration APIs follows the YAML format with several enhancements:</p>

<ul>
  <li>Accept scientific notation without decimal point in case of YAML 1.1</li>
  <li>Support a custom YAML constructor <code class="language-plaintext highlighter-rouge">!include</code> for ease of hierarchical configuration management
    <ul>
      <li>The imported YAML config is allowed to update its parent YAML config nodes</li>
    </ul>
  </li>
</ul>

<p>Here is a sample <code class="language-plaintext highlighter-rouge">app</code> project with configuration files under <code class="language-plaintext highlighter-rouge">configs/</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>|____app
| |____configs
| | |____defaults.yml
| | |____sites
| | | |____site2.yml
| | | |____site1.yml
| | |____app.yml
| |____src
| | |____program.py
</code></pre></div></div>

<p>A minimal sample <code class="language-plaintext highlighter-rouge">program.py</code> is as follows to wrap its <code class="language-plaintext highlighter-rouge">main(...)</code> with the <code class="language-plaintext highlighter-rouge">ML</code> app launchar:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python
</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">cfg</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">f"Running main() with cfg=</span><span class="si">{</span><span class="n">cfg</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">ml</span> <span class="kn">import</span> <span class="n">app</span>
    <span class="kn">from</span> <span class="nn">ml.argparse</span> <span class="kn">import</span> <span class="n">ArgumentParser</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">cfg</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
</code></pre></div></div>

<p>Sample configuration files are placed under <code class="language-plaintext highlighter-rouge">configs/</code>.
The top level one is <code class="language-plaintext highlighter-rouge">configs/app.yml</code> for the program to invoke with option <code class="language-plaintext highlighter-rouge">--cfg</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$&gt;</span> ./program.py <span class="nt">--cfg</span> configs/app.yml
</code></pre></div></div>

<p>Looking into <code class="language-plaintext highlighter-rouge">configs/app.yml</code> below, a custom <code class="language-plaintext highlighter-rouge">!include</code> constructor is supported to include a specific configuration file that updates its parent configurations.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">import</span><span class="pi">:</span>
  <span class="na">defaults</span><span class="pi">:</span> 
    <span class="na">app_site</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">defaults.yml</span>
  <span class="na">app_site</span><span class="pi">:</span> <span class="kt">!include</span> <span class="s">sites/site1.yml</span>

<span class="na">app_platform</span><span class="pi">:</span> <span class="s">Apple M1</span>
<span class="na">app_OS</span><span class="pi">:</span> <span class="s">MacOSX</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">configs/defaults.yml</code> serves as the default site config as follows:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">name</span><span class="pi">:</span> <span class="s">Little Planet Branch</span>
  <span class="na">location</span><span class="pi">:</span> <span class="s">St. Louis, MO</span>
  <span class="na">template</span><span class="pi">:</span> <span class="s">XXX</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">configs/sites/site1.yml</code> is the configuration for a specific site that may overwrite the defualts:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="na">name</span><span class="pi">:</span> <span class="s">site1</span>
  <span class="na">location</span><span class="pi">:</span> <span class="s">Santa Clara, CA</span>
  <span class="na">note</span><span class="pi">:</span> <span class="s">Welcome to CA</span>
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">app.yml</code> includes <code class="language-plaintext highlighter-rouge">site1.yml</code>, <code class="language-plaintext highlighter-rouge">site1.yml</code> will update the configuration in <code class="language-plaintext highlighter-rouge">defaults.yml</code> as updating a <code class="language-plaintext highlighter-rouge">Python</code> dictionary.
Therefore, the resulting configuration is as follows:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Running main<span class="o">()</span> with <span class="nv">cfg</span><span class="o">={</span>   <span class="s1">'__file__'</span>: PosixPath<span class="o">(</span><span class="s1">'configs/app.yml'</span><span class="o">)</span>,
    <span class="s1">'app_OS'</span>: <span class="s1">'MacOSX'</span>,
    <span class="s1">'app_platform'</span>: <span class="s1">'Apple M1'</span>,
    <span class="s1">'app_site'</span>: <span class="o">{</span>   <span class="s1">'location'</span>: <span class="s1">'Santa Clara, CA'</span>,
                    <span class="s1">'name'</span>: <span class="s1">'site1'</span>,
                    <span class="s1">'note'</span>: <span class="s1">'Welcome to CA'</span>,
                    <span class="s1">'template'</span>: <span class="s1">'XXX'</span><span class="o">}</span>,
    <span class="s1">'daemon'</span>: False,
    <span class="s1">'deterministic'</span>: False,
    <span class="s1">'dist'</span>: None,
    <span class="s1">'dist_backend'</span>: <span class="s1">'nccl'</span>,
    <span class="s1">'dist_no_sync_bn'</span>: False,
    <span class="s1">'dist_port'</span>: 25900,
    <span class="s1">'dist_url'</span>: <span class="s1">'env://'</span>,
    <span class="s1">'gpu'</span>: <span class="o">[]</span>,
    <span class="s1">'logfile'</span>: None,
    <span class="s1">'logging'</span>: False,
    <span class="s1">'no_gpu'</span>: False,
    <span class="s1">'rank'</span>: <span class="nt">-1</span>,
    <span class="s1">'seed'</span>: 1204,
    <span class="s1">'slurm_constraint'</span>: None,
    <span class="s1">'slurm_cpus_per_task'</span>: 4,
    <span class="s1">'slurm_export'</span>: <span class="s1">''</span>,
    <span class="s1">'slurm_mem'</span>: <span class="s1">'32G'</span>,
    <span class="s1">'slurm_nodelist'</span>: None,
    <span class="s1">'slurm_nodes'</span>: 1,
    <span class="s1">'slurm_ntasks_per_node'</span>: 1,
    <span class="s1">'slurm_partition'</span>: <span class="s1">'gpu'</span>,
    <span class="s1">'slurm_time'</span>: <span class="s1">'0'</span>,
    <span class="s1">'world_size'</span>: <span class="nt">-1</span><span class="o">}</span>
</code></pre></div></div>

<p>Other key-value settings are specified by <code class="language-plaintext highlighter-rouge">ML</code> for other features.
Note only keys <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">location</code> are replced while <code class="language-plaintext highlighter-rouge">template</code> remains as is.
The semantics for additional keys such as <code class="language-plaintext highlighter-rouge">note</code> is to merged with the parent configuration.</p>

<h3 id="hdf5-compression">HDF5 Compression</h3>

<p>When saving Python objects, depending on the suffixes, <code class="language-plaintext highlighter-rouge">pickle</code>, <code class="language-plaintext highlighter-rouge">h5</code> and <code class="language-plaintext highlighter-rouge">pytorch</code> binaries are supported.
If <code class="language-plaintext highlighter-rouge">h5</code> is chosen to save sparse binary features, compression options such as <code class="language-plaintext highlighter-rouge">zstd</code> can be enabled to reduce storage significantly.</p>

<h3 id="gpu-visibility">GPU Visibility</h3>

<p>Deep learning programs tend to access GPUs in parallel.
Managing GPU visibility is crucial to facilitate distributed training and other processing that require GPU access.
<code class="language-plaintext highlighter-rouge">ML</code> provides simple app launcher APIs to support common GPU access options.</p>

<h3 id="daemon-mode">Daemon Mode</h3>

<p>It is common to kick start a long running training process through a remote shell.
Instead of figuring out how <code class="language-plaintext highlighter-rouge">screen</code> and <code class="language-plaintext highlighter-rouge">nohup</code> work, turning a process into a daemon to detach from the terminal is as simple as providing a command line option.
The <code class="language-plaintext highlighter-rouge">ML</code> app launcher APIs deal with the underlying complexities as usual as running the same program in the foreground.</p>

<h3 id="distributed-training-and-execution">Distributed Training and Execution</h3>

<p>Composing a distributed parallel program in Python can be daunting and error prone.
The <code class="language-plaintext highlighter-rouge">ML</code> app launcher APIs support <code class="language-plaintext highlighter-rouge">PyTorch</code> and <code class="language-plaintext highlighter-rouge">SLURM</code> backends for training and general execution given command line options.
The <code class="language-plaintext highlighter-rouge">PyTorch</code> backend assumes one GPU per worker process on one GPU node.
The <code class="language-plaintext highlighter-rouge">SLRUM</code> backend supports a cluster environment and execution across multiple GPU nodes.</p>

<h3 id="tensorrt-deployment">TensorRT Deployment</h3>

<p>For production inference to be competitie, ML model deployment optimization is necessary to reduce the runtime cost.
<code class="language-plaintext highlighter-rouge">TensorRT</code> is a popular backend for <code class="language-plaintext highlighter-rouge">ML</code> to support.
The APIs make it straighforward to convert a pretrained model into its TensorRT counterpart.</p>

<h3 id="checkpoints-from-awss3-and-google-drive">Checkpoints from AWS/S3 and Google Drive</h3>

<p>By default, <code class="language-plaintext highlighter-rouge">PyTorch</code> hub APIs only supports loading checkpoints from direct URLs.
<code class="language-plaintext highlighter-rouge">ML</code> hub APIs further supports AWS/S3 and Google Drive for private or 3rd party checkpoint storage.
This makes it easy for business deployment at a low cost.</p>

<h2 id="ml-vision"><a href="https://github.com/necla-ml/ML-Vision">ML-Vision</a></h2>
<h2 id="ml-ws"><a href="https://github.com/necla-ml/ML-WS">ML-WS</a></h2>
<h2 id="feedstocks"><a href="https://github.com/necla-ml/feedstocks">feedstocks</a></h2>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Farley&#39;s personal website.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/farleylai" target="_blank" title="farleylai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/farleylai" target="_blank" title="farleylai"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
